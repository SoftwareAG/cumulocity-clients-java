#!/bin/bash
BIN=/usr/lib/@package.directory@
CONF=$BIN/@package.name@.conf
REQUIRED_VERSION="@package.required-java@"
if [ -f $CONF ];
then
    source $CONF
fi

JAVA_PATH=`$BIN/detect-java`
jvm_gc=${JAVA_GC:-"@package.jvm-gc@"}
jvm_mem=${JAVA_MEM:-"@package.jvm-mem@"}
jvm_opts=${JAVA_OPTS:-"-server -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/log/@package.directory@/@package.name@-%p.hprof -XX:NativeMemoryTracking=summary -XX:+PrintGCDetails -XX:+PrintGCDateStamps -Xloggc:/log/@package.directory@/@package.name@-gc.log -XX:-UseGCLogFileRotation -XX:NumberOfGCLogFiles=1 -XX:GCLogFileSize=50M"}
arguments=${ARGUMENTS:-"@package.arguments@"}


mkdir -p /var/log/@package.directory@; echo "heap dumps  /var/log/@package.directory@/heap-dump-<pid>.hprof"

exec $JAVA_PATH/bin/java ${jvm_opts} ${jvm_gc} ${jvm_mem} -jar $BIN/@package.name@.jar ${arguments}
